# **Capítulo 15 – IP Services**

## **1. Introducción**

Los **servicios IP** son funciones que **no enrutan tráfico directamente**, pero **mejoran la operación, gestión y estabilidad de la red**.  
Estos servicios incluyen:

- Sincronización de tiempo (NTP)
    
- Registro de eventos (Syslog)
    
- Monitoreo de dispositivos (SNMP)
    
- Captura de tráfico (SPAN)
    
- Exportación de flujo (NetFlow)
    
- Alta disponibilidad (HSRP, VRRP, GLBP)
    
- DHCP y NAT
    

---

## **2. NTP (Network Time Protocol)**

**NTP** sincroniza los relojes de todos los dispositivos de red con una fuente horaria precisa.  
Una sincronización correcta es vital para correlacionar registros, autenticaciones y eventos de seguridad.

### **Jerarquía (Stratum)**

- **Stratum 1:** reloj atómico o GPS.
    
- **Stratum 2:** sincronizado con Stratum 1.
    
- **Stratum 3+:** niveles inferiores.
    

**Configuración básica:**

```
ntp server 192.168.1.10
ntp update-calendar
```

**Verificación:**

```
show ntp status
show ntp associations
```

**Modo cliente-servidor y autenticación:**

```
ntp authenticate
ntp authentication-key 1 md5 cisco123
ntp trusted-key 1
ntp server 192.168.1.10 key 1
```
---

## **3. Syslog (System Logging Protocol)**

**Syslog** centraliza la recolección de mensajes y eventos del sistema, permitiendo auditoría y diagnóstico.

**Niveles de severidad (0–7):**

|Nivel|Nombre|Descripción|
|---|---|---|
|0|Emergencies|Sistema inutilizable|
|1|Alerts|Acción inmediata requerida|
|2|Critical|Fallos críticos|
|3|Errors|Errores generales|
|4|Warnings|Advertencias|
|5|Notifications|Información normal significativa|
|6|Informational|Mensajes informativos|
|7|Debugging|Información detallada de depuración|

**Configuración:**

```
logging 10.1.1.100
logging trap warnings
service timestamps log datetime msec
logging buffered 8192 debugging
logging 10.1.1.100
logging trap warnings
service timestamps log datetime msec
logging buffered 8192 debugging
```

**Verificación:**

```
show logging
```

**Importante:**  
Se recomienda usar **NTP + Syslog** para correlación temporal de eventos.

---

## **4. SNMP (Simple Network Management Protocol)**

Proporciona **monitoreo y gestión remota** de dispositivos de red mediante un **Network Management Station (NMS)**.

### **Versiones**

|Versión|Seguridad|Características|
|---|---|---|
|**v1**|Sin autenticación|Obsoleta|
|**v2c**|Comunidades (plaintext)|Lectura/escritura básica|
|**v3**|Autenticación y cifrado|Recomendado|

### **Modos SNMPv3**

|Modo|Seguridad|Descripción|
|---|---|---|
|noAuthNoPriv|Ninguna|Solo nombre de usuario|
|authNoPriv|Autenticación (MD5/SHA)|Sin cifrado|
|authPriv|Autenticación y cifrado (DES/AES)|Completo|

**Configuración básica (v2c):**

```
snmp-server community cisco RO
snmp-server community admin RW
snmp-server location Madrid
snmp-server contact soporte@empresa.com
```
**Configuración (v3 segura):**

```
snmp-server group SECURE v3 priv
snmp-server user admin SECURE v3 auth sha clave123 priv aes 128 clavePrivada
```

**Verificación:**

```
show snmp group
show snmp user
```

---

## **5. NetFlow**

**NetFlow** analiza el tráfico IP capturando información de cada flujo.  
Cada flujo está identificado por el **“conjunto de 7 tuplas”**:

```
(Src IP, Dst IP, Src Port, Dst Port, Protocol, ToS, Input Interface)
```

**Usos:**

- Monitoreo de tráfico
    
- Planeamiento de capacidad
    
- Detección de anomalías o ataques DDoS
    

**Configuración básica (NetFlow v9):**

```
ip flow-export version 9
ip flow-export destination 10.10.10.100 2055
interface GigabitEthernet0/0
 ip flow ingress
 ip flow egress
```

**Verificación:**

```
show ip cache flow
show ip flow export
```

---

## **6. SPAN (Switched Port Analyzer)**

Permite **clonar tráfico** de una interfaz o VLAN hacia otra, para monitoreo o captura (Wireshark, IDS, etc.).

**Configuración básica:**

```
monitor session 1 source interface Gi0/1
monitor session 1 destination interface Gi0/24
```

**Para VLANs:**

```
monitor session 2 source vlan 10,20
monitor session 2 destination interface Gi0/48
```

**Verificación:**

```
show monitor session all
```

---

## **7. DHCP (Dynamic Host Configuration Protocol)**

Asigna dinámicamente direcciones IP y parámetros de red (gateway, DNS, etc.) a los clientes.

**Configuración básica (router Cisco):**

```
ip dhcp pool LAN
 network 192.168.1.0 255.255.255.0
 default-router 192.168.1.1
 dns-server 8.8.8.8
 lease 7
!
ip dhcp excluded-address 192.168.1.1 192.168.1.20
```

**Relay DHCP:**

```
interface GigabitEthernet0/1
 ip helper-address 10.1.1.10
```

**Verificación:**

```
show ip dhcp binding
show ip dhcp pool
```

---

## **8. NAT (Network Address Translation)**

Traduce direcciones privadas internas a direcciones públicas o externas.

### **Tipos de NAT**

|Tipo|Descripción|
|---|---|
|**Static NAT**|IP fija 1:1|
|**Dynamic NAT**|Traducción desde un pool|
|**PAT (Overload)**|Traducción múltiple por puerto (más común)|

**Configuración ejemplo (PAT):**

```
ip nat inside source list 1 interface GigabitEthernet0/0 overload
access-list 1 permit 192.168.1.0 0.0.0.255
interface GigabitEthernet0/0
 ip nat outside
interface GigabitEthernet0/1
 ip nat inside
```
**Verificación:**

```
show ip nat translations
show ip nat statistics
```

---

## **9. HSRP, VRRP y GLBP (Alta Disponibilidad)**

### **HSRP (Hot Standby Router Protocol)** – Cisco propietario

Crea una **IP virtual compartida** entre routers de gateway redundantes.

```
interface Gi0/0
 standby 1 ip 192.168.1.254
 standby 1 priority 110
 standby 1 preempt
```

**Verificación:**

```
show standby brief
```

### **VRRP (Virtual Router Redundancy Protocol)** – estándar IETF (RFC 5798)

Similar a HSRP, pero soportado multi-vendor.

### **GLBP (Gateway Load Balancing Protocol)**

Proporciona **balanceo de carga + redundancia**.  
Cada router actúa como gateway activo para diferentes hosts.

---

## **10. IP SLA (Service Level Agreement)**

Permite medir **latencia, jitter y pérdida de paquetes** en tiempo real entre routers.

**Configuración ejemplo:**

```
ip sla 1
 icmp-echo 8.8.8.8 source-interface Gi0/0
 frequency 10
ip sla schedule 1 life forever start-time now
```
**Verificación:**

```
show ip sla statistics
show ip sla configuration
```

---

## **11. Verificación General de Servicios**

|Servicio|Comando de diagnóstico|
|---|---|
|NTP|`show ntp associations`, `debug ntp events`|
|Syslog|`show logging`|
|SNMP|`show snmp user`, `show snmp group`|
|NetFlow|`show ip cache flow`|
|DHCP|`show ip dhcp binding`|
|NAT|`show ip nat translations`|
|HSRP|`show standby brief`|
|IP SLA|`show ip sla statistics`|