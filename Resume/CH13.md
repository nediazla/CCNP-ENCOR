# **Capítulo 13 – IP Multicast**

## **1. Introducción**

El **multicast IP** permite el envío eficiente de datos desde una o varias fuentes hacia múltiples receptores simultáneamente.  
A diferencia del unicast (una fuente → un destino) o broadcast (una fuente → todos), multicast **solo entrega tráfico a los hosts que lo solicitan**.

**Ejemplo de uso:**

- Videoconferencias (Webex, Zoom corporativo)
    
- Distribución de software
    
- Streaming de video / IPTV
    
- Actualización simultánea de sistemas en una red empresarial
    

---

## **2. Direcciones Multicast IPv4**

Las direcciones multicast pertenecen al **rango Clase D**:

```
224.0.0.0 – 239.255.255.255
```

### **Rangos específicos**

|Rango|Uso|
|---|---|
|224.0.0.0 – 224.0.0.255|Alcance local del segmento (link-local). Ejemplo: 224.0.0.5 (OSPF), 224.0.0.9 (RIPv2).|
|224.0.1.0 – 238.255.255.255|Alcance global (enrutado).|
|239.0.0.0 – 239.255.255.255|Alcance administrativamente local (organizacional).|

**Importante:**  
Las direcciones multicast **no aparecen en tablas ARP**; se mapean directamente a **direcciones MAC multicast** (IEEE 802.1D).

---

## **3. Direcciones Multicast IPv6**

En IPv6, todas las direcciones multicast comienzan con:

```
FF00::/8
```

Formato:

```
FFxy::/16
```

- **x**: flags (por ejemplo, “0” para permanente).
    
- **y**: scope (alcance):
    
    - 1 = Interface-local
        
    - 2 = Link-local
        
    - 5 = Site-local
        
    - E = Global
        

Ejemplo:  
`FF02::1` → todos los nodos link-local  
`FF02::2` → todos los routers link-local

---

## **4. Componentes del Multicast**

|Elemento|Descripción|
|---|---|
|**Host receptor**|Dispositivo que desea unirse a un grupo multicast.|
|**Multicast Source**|Genera y transmite el flujo multicast (S).|
|**Group Address (G)**|Dirección del grupo multicast (por ejemplo, 239.1.1.1).|
|**Multicast Router**|Reenvía el tráfico multicast solo hacia interfaces con receptores interesados.|

Modelo general:

```
S → (routers multicast) → {R1, R2, R3}
```

---

## **5. Protocolos Multicast**

El multicast opera mediante varios protocolos cooperativos:

|Capa|Protocolo|Función|
|---|---|---|
|Capa 3|**IGMP / MLD**|Registro de hosts en grupos multicast.|
|Capa 3|**PIM (Sparse/Dense Mode)**|Construcción de rutas multicast.|
|Capa 2|**IGMP Snooping**|Optimiza el reenvío multicast en switches.|
|Capa 3|**MSDP / MBGP**|Interconecta dominios multicast.|

---

## **6. IGMP (Internet Group Management Protocol)**

Permite a los hosts informar a su router local que desean recibir tráfico multicast.

### **Versiones**

|Versión|RFC|Características|
|---|---|---|
|IGMPv1|RFC 1112|Sin leave message; tiempo de espera largo.|
|IGMPv2|RFC 2236|Introduce _Leave Group_ y _Querier Election_.|
|IGMPv3|RFC 3376|Soporta **Source-Specific Multicast (SSM)**.|

**Direcciones relevantes:**

- 224.0.0.1 → Todos los hosts multicast
    
- 224.0.0.2 → Todos los routers multicast
    
- 224.0.0.22 → Usado por IGMPv3
    

**Comandos de verificación:**

```
show ip igmp groups
show ip igmp interface
show ip igmp membership
```

---

## **7. PIM (Protocol Independent Multicast)**

PIM es el protocolo de enrutamiento que determina el camino que seguirá el tráfico multicast entre routers.

**"Protocol Independent"** significa que PIM puede funcionar sobre cualquier IGP (OSPF, EIGRP, etc.).

### **Modos de operación**

|Modo|Descripción|Ejemplo de uso|
|---|---|---|
|**Dense Mode (PIM-DM)**|Asume que todos los routers quieren recibir el tráfico. Usa _Flood & Prune_.|Pequeñas redes cerradas.|
|**Sparse Mode (PIM-SM)**|Solo reenvía tráfico a routers con receptores interesados. Usa **RP (Rendezvous Point)**.|Grandes redes empresariales.|
|**Sparse-Dense Mode**|Opera dinámicamente en modo denso o disperso.|Migraciones o entornos mixtos.|
|**PIM-SSM (Source-Specific)**|Comunicación directa fuente→receptor sin RP.|IPTV, streaming unidireccional.|

---

## **8. PIM Sparse Mode y el RP (Rendezvous Point)**

El **Rendezvous Point (RP)** actúa como punto central donde las fuentes anuncian su tráfico y los receptores se registran para recibirlo.

### **Métodos para anunciar el RP**

- **Estático:**
    
```
ip pim rp-address 10.10.10.1
```
    
- **Auto-RP (Cisco propietario)**
    
- **Bootstrap Router (BSR)** – método estándar IETF
    

**Comando de verificación:**

```
show ip pim rp
show ip pim neighbors
show ip mroute
```

---

## **9. Árboles Multicast**

Existen dos tipos de árboles que describen cómo fluye el tráfico multicast:

|Tipo|Nombre|Descripción|
|---|---|---|
|**Shared Tree (RPT)**|(*,G)|Todo el tráfico pasa inicialmente por el RP.|
|**Source Tree (SPT)**|(S,G)|Tráfico directo desde la fuente al receptor.|

**Transición RPT → SPT:**  
Ocurre cuando el router receptor empieza a recibir flujo directo desde la fuente, optimizando la ruta.

---

## **10. Source-Specific Multicast (SSM)**

- Simplifica el proceso eliminando la necesidad de un RP.
    
- El receptor especifica **qué fuente (S)** desea recibir para un grupo (G).
    
- Requiere IGMPv3.
    

**Rango de direcciones SSM:**

```
232.0.0.0 – 232.255.255.255
```

**Configuración:**

```
ip pim ssm range 232.0.0.0/8
```

---

## **11. IGMP Snooping (Capa 2)**

Los switches usan **IGMP Snooping** para escuchar los mensajes IGMP y reenviar tráfico multicast **solo a los puertos que lo necesitan**.  
Sin esta función, el tráfico multicast sería tratado como broadcast.

**Verificación:**

```
show ip igmp snooping
```

---

## **12. MSDP y MBGP**

En redes con múltiples dominios PIM-SM (por ejemplo, entre proveedores o campus separados):

- **MSDP (Multicast Source Discovery Protocol):** permite compartir información de fuentes activas entre RPs de distintos dominios.
    
- **MBGP (Multiprotocol BGP):** distribuye rutas multicast (AFI=1, SAFI=2) separadas de las rutas unicast.
    

---

## **13. Troubleshooting Multicast**

|Problema|Verificación|
|---|---|
|Faltan receptores|`show ip igmp groups`|
|RP incorrecto|`show ip pim rp mapping`|
|Pérdida de tráfico|`show ip mroute`|
|Tabla PIM vacía|`show ip pim neighbor`|
|Error en capa 2|`show ip igmp snooping vlan <id>`|

---

## **14. Puntos clave para el examen ENCOR 350-401**

|Tema|Clave|
|---|---|
|Direcciones IPv4 multicast|224.0.0.0 – 239.255.255.255|
|IGMPv3|Soporta SSM (Source-Specific Multicast)|
|PIM-DM / PIM-SM|Flood & Prune vs RP-based|
|RP|Punto de encuentro en PIM-SM|
|Árboles multicast|(*,G) Shared / (S,G) Source|
|IGMP Snooping|Filtrado multicast en switches|
|SSM Range|232.0.0.0/8|
|Comandos clave|`show ip mroute`, `show ip pim rp`, `show ip igmp groups`|