# **Capítulo 19 – Wireless Roaming and Location Services**

---

# **1. Introducción al Roaming Wi-Fi**

Roaming es el proceso mediante el cual un cliente Wi-Fi pasa de un AP a otro **sin perder conectividad**.  
En redes empresariales, roaming correcto significa:

- menos latencia
    
- menos pérdida de paquetes
    
- llamadas VoIP sin cortes
    
- experiencia estable en movimiento
    

Un roaming mal diseñado genera:

- desconexiones
    
- timeouts
    
- jitter en voz
    
- baja calidad de video
    

**Importante:**  
El roaming depende _principalmente del cliente_, no del AP.

---

# **2. ¿Cuándo decide un cliente que debe hacer roaming?**

Generalmente cuando:

- el **RSSI** cae por debajo de umbral (−70 dBm aproximado)
    
- la calidad de señal baja (SNR < 25 dB)
    
- detecta APs vecinos con mejor potencia
    
- recibe mecanismos de ayuda (k, r, v)
    

Los clientes toman la decisión basados en:

- RSSI
    
- SNR
    
- interferencia
    
- políticas internas del driver
    
- soporte del estándar (11k, 11r, 11v)
    

---

# **3. Tipos de Roaming**

## **3.1. Roaming entre APs en el mismo WLC**

El caso más simple:

- Ambos APs están controlados por el mismo **WLC**
    
- El controlador preserva las claves, políticas y estados
    

Roaming rápido y seguro.

## **3.2. Roaming entre WLCs distintos (intra mobility domain)**

Cuando dos WLC están en el mismo **mobility group**:

- comparten información de clientes
    
- intercambian PMKs (Pairwise Master Keys)
    
- roaming fluido
    

## **3.3. Roaming entre WLCs en distintas ubicaciones (inter mobility domain)**

Más lento porque:

- se renegocia seguridad
    
- se reestablecen políticas
    

---

# **4. 802.11k – Radio Resource Management (RRM) Assistance**

802.11k permite que el AP **ayude al cliente** a identificar mejores opciones de roaming.

El AP entrega:

- lista de APs vecinos
    
- canales, BSSID, potencia
    
- métricas RF
    

El cliente no necesita escanear aleatoriamente → **menos latencia**.

**Beneficio:** Mejora roaming para voz y dispositivos móviles.

---

# **5. 802.11r – Fast BSS Transition (FT)**

802.11r permite que el cliente **prepare la clave de seguridad ANTES de moverse al nuevo AP**.

Esto elimina el tiempo de renegociación 802.1X/PSK, evitando:

- cortes de voz
    
- delays de autenticación
    
- pérdida de paquetes
    

Soporta dos modos:

- **FT-over-the-Air:** negociación directa con el nuevo AP
    
- **FT-over-the-DS:** negociación a través del AP actual
    

Muy importante para:

- VoIP
    
- dispositivos móviles (iPhone, Android)
    
- entornos de movilidad densa (hospitales, almacenes, universidades)
    

---

# **6. 802.11v – BSS Transition Management**

802.11v permite que el AP sugiera al cliente **moverse a un AP mejor**.

Funciones:

- BSS Transition Request
    
- Time-of-day parameters
    
- Power-saving optimization
    
- Load balancing
    

**No obliga al cliente**, solo recomienda.

---

# **7. Cómo ocurre el roaming (proceso técnico)**

### **Etapas:**

1. **Scanning**  
    Cliente escucha APs vecinos (pasivo o activo).
    
2. **Authentication**  
    Autenticación 802.11 (Open/Secure).
    
3. **Association**  
    Cliente se asocia al nuevo AP.
    
4. **4-Way Handshake** (WPA2/WPA3)  
    Si hay FT (11r), esto ya está pre-negociado.
    
5. **Key install**  
    Se instalan claves PTK/GTK en el nuevo AP.
    
6. **Reinicio de tráfico**  
    Sesiones IP continúan sin interrupción.
    

---

# **8. Factores que afectan el roaming**

### **1. Diseño RF**

- APs demasiado cerca → sticky clients
    
- APs demasiado lejos → caída de servicio
    
- RSSI inconsistente
    
- excesivo overlap de canales
    

### **2. Interferencias**

- CCI (co-channel interference)
    
- ACI (adjacent-channel interference)
    

### **3. Potencia mal configurada**

- Potencia alta → clientes se “pegan” a APs lejanos
    
- Potencia baja → demasiados roams
    

### **4. Umbrales del cliente**

Cada fabricante tiene políticas internas:

- iOS
    
- Android
    
- Windows
    
- scanners industriales
    

---

# **9. Load Balancing y Sticky Clients**

El WLC puede sugerir dispersión de clientes:

- evitar saturación de un solo AP
    
- mejorar uso de la red
    

Sticky client = cliente que está pegado a un AP con mala señal.  
Puede mitigarse con:

- 802.11k/v
    
- RRM (load/band select)
    
- ajustes de potencia AP
    

---

# **10. Location Services (RTLS – Real-Time Location Services)**

La localización Wi-Fi permite ubicar dispositivos dentro de un edificio en tiempo real.  
Usado en:

- hospitales (equipos biomédicos)
    
- almacenes (robots, inventario)
    
- oficinas (personas, activos)
    
- seguridad (tracking, geofencing)
    

### **Métodos de ubicación**

#### **1. Triangulación RSSI**

El método más común.  
Basado en:

- potencia recibida en múltiples APs
    
- mapa calibrado del edificio
    

Precisión aproximada: **3–10 metros**

#### **2. Time Difference of Arrival (TDoA)**

Basado en la diferencia de tiempos de llegada.  
Más preciso, requiere hardware especializado.

#### **3. Angle of Arrival (AoA)**

Usa múltiples antenas direccionales.  
Se utiliza en soluciones avanzadas.

#### **4. Fingerprinting**

Método basado en “huella digital RF” del edificio.

---

# **11. Cisco DNA Spaces / CMX (Mobility Services)**

Cisco implementa servicios de localización mediante:

- **Cisco CMX** (tradicional)
    
- **Cisco DNA Spaces** (cloud)
    

Funciones:

- heat maps
    
- tracking de activos
    
- analíticas de presencia
    
- proximidad
    
- APIs de localización
    

Se integra con WLC 9800, Catalyst y Wi-Fi 6/6E.

---

# **12. Protocolo de localización – NDP (Neighbor Discovery Protocol de Cisco)**

Los AP transmiten paquetes especiales NDP para:

- calibrar ubicación
    
- detectar estructuras
    
- proporcionar datos a motores de cálculo
    

No tiene relación con IPv6 NDP; es un protocolo interno de Cisco Wireless.