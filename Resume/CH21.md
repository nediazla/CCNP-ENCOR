# **Capítulo 21 – Troubleshooting Wireless Connectivity**

El troubleshooting en redes inalámbricas es una combinación de **análisis de RF, verificación de configuraciones**, pruebas de conectividad y validación de políticas de seguridad. Wi-Fi introduce variables adicionales que no existen en redes cableadas: interferencias, cobertura, potencia, canales, DFS, autenticación RF, roaming, etc.

---

# **1. Metodología general para diagnosticar Wi-Fi**

Los problemas Wi-Fi se agrupan en seis áreas:

1. **RF / Señal**
    
2. **Asociación (Layer 2)**
    
3. **Autenticación (802.1X / PSK)**
    
4. **Direcciones IP (DHCP)**
    
5. **Conectividad de capa 3 (routing/NAT)**
    
6. **Aplicaciones (QoS / roaming / firewall)**
    

El enfoque recomendado:

```
¿El cliente ve la red?  →  ¿Puede asociarse?  →  ¿Puede autenticarse?  
  → ¿Obtiene IP? → ¿Navega? → ¿Roaming falla?
```

---

# **2. Fallos típicos de RF (capa física)**

### **Síntomas**

- Señal débil (RSSI bajo)
    
- SNR pobre
    
- Altas tasas de retransmisión
    
- Caída constante de velocidad
    
- Conexión intermitente
    

### **Causas comunes**

- Distancia excesiva al AP
    
- Obstáculos (paredes, vidrio, metal, cuerpos humanos)
    
- Interferencia de dispositivos (2.4 GHz es especialmente ruidoso)
    
- Mala elección de canal o solapamiento
    
- DFS obligando al AP a cambiar de canal sin aviso
    
- Ancho de canal demasiado grande (80/160 MHz) en entornos densos
    

### **Soluciones**

- Reducir ancho de canal
    
- Cambiar canal manualmente (evitar DFS si es posible)
    
- Reubicar AP
    
- Ajustar potencia (no usar 100%, produce celdas desbalanceadas)
    
- Revisar antenas externas
    

---

# **3. Problemas de asociación (Layer 2)**

**Asociación** = cuando el cliente se conecta a la BSSID.

### **Causas típicas**

- SSID deshabilitado o no transmitido
    
- Cliente incompatible (p.ej., solo 2.4 GHz intentando unirse a SSID en 5 GHz)
    
- Configuración de banda incorrecta o band-steering agresivo
    
- Máximo número de clientes alcanzado en el AP
    
- Canal DFS no soportado por el cliente
    
- Seguridad mal configurada
    

### **Comandos de verificación (WLC Cisco)**

```
show client summary
show ap auto-rf
show wlan <id>
show ap config 802.11a <AP>
show ap config 802.11b <AP>
```
### **Soluciones**

- Asegurar que el SSID está habilitado
    
- Revisar compatibilidad de bandas (2.4 / 5 / 6 GHz)
    
- Bajara agresividad de band-steering
    
- Validar tipo de seguridad (WPA2/WPA3) entre cliente y AP
    

---

# **4. Problemas de autenticación (802.1X / PSK)**

### **Síntomas**

- "Unable to join the network"
    
- Reintentos constantes de conexión
    
- Mensajes de 802.1X EAP failures
    
- El cliente entra en bucle de autenticación
    

### **Causas**

- Contraseña PSK incorrecta
    
- Certificados inválidos en 802.1X
    
- Falta de reachability al Radius (ISE, FreeRADIUS)
    
- Clocks fuera de sincronía (falla EAP-TLS → NTP crítico)
    
- Policies del servidor rechazando al cliente
    
- Problemas con PMF (Protected Management Frames)
    

### **Soluciones**

- Verificar PSK / certificados
    
- Revisar NTP en WLC, AP y Radius
    
- Revisar logs del Radius
    
- Desactivar temporalmente **PMF** para pruebas
    
- Validar VLAN asignada por Radius
    

---

# **5. Problemas DHCP (no obtiene dirección IP)**

### **Síntomas**

- Cliente conectado pero sin IP
    
- Recibe APIPA (169.254.x.x)
    

### **Causas**

- DHCP server inalcanzable
    
- `ip helper-address` no configurado
    
- VLAN incorrecta en WLAN o AP
    
- Pools agotados
    
- Firewall bloqueando UDP 67/68
    
- Túneles CAPWAP mal formados
    

### **Soluciones**

- Verificar reachability al servidor DHCP
    
- Validar la VLAN del SSID en el switch
    
- Revisar pool disponible
    
- Revisar que el WLC reenvía DHCP correctamente
    

### **Comandos WLC**

```
show dhcp proxy
show wlan <id>
```

---

# **6. Problemas de autenticación L3 (captive portal / ACLs)**

Usado en:

- Guest Wi-Fi
    
- BYOD
    
- Hotspots
    

### **Fallos típicos**

- Cliente ve el portal pero no puede navegar
    
- Página de autenticación no aparece
    
- Redirección HTTP/HTTPS bloqueada
    

### **Soluciones**

- Asegurar que el cliente usa DNS compatible
    
- Asegurar que HTTPS redirection no está siendo bloqueado
    
- Revisar ACL pre-autenticación
    

---

# **7. Problemas de roaming**

Roaming = cliente cambia de AP sin perder sesión.

### **Síntomas**

- Cortes de llamadas VoIP
    
- Microcortes al moverse
    
- Latencias altas durante el roaming
    

### **Causas**

- Diferencias de potencia entre APs
    
- Celdas demasiado grandes
    
- APs en canales superpuestos
    
- PMK caching o 802.11r mal configurado
    
- DFS interrumpiendo clientes durante el roaming
    
- Controladoras o mobility groups mal configurados
    

### **Soluciones**

- Ajustar potencia para celdas equilibradas
    
- Habilitar Fast Roaming (802.11r / 802.11k / 802.11v)
    
- Verificar que los APs están en el **mismo mobility domain**
    
- Evitar canales DFS si los clientes no los soportan
    

---

# **8. Fallos CAPWAP (modo Controlador-AP)**

En redes con WLC (Cisco), los AP dependen de CAPWAP.

### **Problemas típicos**

- AP no se une al WLC
    
- AP queda en modo "Discovery"
    
- AP pierde keepalives
    

### **Causas**

- Firewall bloqueando puertos UDP 5246/5247
    
- Certificados (MIC/SSC) caducados
    
- VLAN de administración incorrecta
    
- DHCP Option 43 mal configurada
    
- WLC sin licencia para más APs
    

### **Verificación**

```
show ap join stats summary all
debug capwap events enable
debug capwap errors enable
```

---

# **9. Problemas de interferencia no Wi-Fi**

Interferencias provocadas por:

- Microondas
    
- Cámaras inalámbricas analógicas
    
- Teléfonos DECT
    
- Mandos a distancia
    
- Bluetooth
    
- Motores eléctricos
    

Síntomas:

- Señal buena pero throughput pésimo
    
- Variaciones locas en RSSI
    
- Ping muy inestable
    

Solución recomendada:  
**Site survey + analizador de espectro**.

---

# **10. Herramientas de troubleshooting**

### **En APs y WLC**

- `show client summary`
    
- `show client detail <mac>`
    
- `show ap auto-rf`
    
- `debug client <mac>`
    
- `debug dot11 <interface>`
    
- `show wlan <id>`
    

### **En switches**

- `show mac address-table`
    
- `show spanning-tree vlan`
    
- `show interface trunk`
    
- `show power inline` (APs PoE)
    

### **En el cliente**

- Ping, traceroute
    
- Validación IP/DNS
    
- Power/signal checks
    
- Wi-Fi analyzer